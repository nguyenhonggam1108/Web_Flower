{% extends 'dashboard/base_admin.html' %}
{% load humanize %}
{% block title %}Qu·∫£n l√Ω ƒë∆°n h√†ng{% endblock %}
{% block content %}
<div class="container mt-4">
     <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>üßæ Qu·∫£n l√Ω ƒë∆°n h√†ng</h2>
        <div>
          <a href="{% url 'dashboard:dashboard' %}" class="btn btn-secondary me-2">‚Üê Quay v·ªÅ Dashboard</a>
        </div>
    </div>
  <form method="get" class="row g-2 mb-3">
    <div class="col-md-4">
      <input type="text" name="q" class="form-control" placeholder="T√¨m theo t√™n / email / phone / id" value="{{ q }}">
    </div>
    <div class="col-md-3">
      <select name="status" class="form-select">
        <option value="">-- T·∫•t c·∫£ tr·∫°ng th√°i --</option>
        {% for val, label in status_choices %}
          <option value="{{ val }}" {% if selected_status == val %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-2">
      <button class="btn btn-primary">L·ªçc</button>
    </div>
  </form>

  <table class="table table-striped">
    <thead class="table-dark">
      <tr>
        <th>#</th>
        <th>Kh√°ch</th>
        <th>Giao h√†ng</th>
        <th>Thanh to√°n</th>
        <th>T·ªïng</th>
        <th>Tr·∫°ng th√°i</th>
        <th>Ng√†y</th>
        <th>Thao t√°c</th>
      </tr>
    </thead>
    <tbody>
      {% for order in orders %}
      <tr>
        <td>{{ order.id }}</td>
        <td>{{ order.full_name }}<br><small>{{ order.email }} / {{ order.phone }}</small></td>

        <td>
          {% if order.shipping_method == 'PICKUP' %}
            <span class="badge bg-secondary">Nh·∫≠n t·∫°i c·ª≠a h√†ng</span>
          {% elif order.shipping_method == 'DELIVERY' %}
            <span class="badge bg-info text-dark">Giao t·∫≠n n∆°i</span>
          {% else %}
            <span class="badge bg-light text-dark">{{ order.get_shipping_method_display }}</span>
          {% endif %}
        </td>

        <td>
          {% if order.payment_method == 'PAYPAL' %}
            <span class="badge bg-warning text-dark">PayPal</span>
          {% elif order.payment_method == 'COD' %}
            <span class="badge bg-success">Thu ti·ªÅn m·∫∑t</span>
          {% else %}
            <span class="badge bg-light text-dark">{{ order.get_payment_method_display }}</span>
          {% endif %}
        </td>

        <td>{{ order.final_total|floatformat:0|intcomma }} VND</td>
        <td>{{ order.get_status_display }}</td>
        <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
        <td>
          <a href="{% url 'orders_admin:detail' order.id %}" class="btn btn-sm btn-info">Chi ti·∫øt</a>
        </td>
      </tr>
      {% empty %}
      <tr><td colspan="8" class="text-center">Kh√¥ng c√≥ ƒë∆°n h√†ng</td></tr>
      {% endfor %}
    </tbody>
  </table>

  {% if is_paginated %}
    <nav>
      <ul class="pagination">
        {% if page_obj.has_previous %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if q %}&q={{ q }}{% endif %}{% if selected_status %}&status={{ selected_status }}{% endif %}">Tr∆∞·ªõc</a></li>
        {% endif %}
        <li class="page-item disabled"><span class="page-link">Trang {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span></li>
        {% if page_obj.has_next %}
          <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}{% if q %}&q={{ q }}{% endif %}{% if selected_status %}&status={{ selected_status }}{% endif %}">Sau</a></li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}
</div>
{% endblock %}